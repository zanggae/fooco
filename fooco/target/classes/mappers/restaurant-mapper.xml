<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="restaurantMapper">
	<resultMap type="Res" id="RestaurantMap">
		<id property="resId" column="RES_ID"/>
		<result property="resCategoryId" column="RES_CATEGORY_ID"/>
		<result property="resCategoryName" column="RES_CATEGORY_NAME"/>
		<result property="locationId" column="LOCATION_ID"/>
		<result property="locationName" column="LOCATION_NAME"/>
		<result property="resName" column="RES_NAME"/>
		<result property="resAddress" column="RES_ADDRESS"/>
		<result property="resContent" column="RES_CONTENT"/>
		<result property="resTime" column="RES_TIME"/>
		<result property="resStatus" column="RES_STATUS"/>
		<result property="resCreateDate" column="RES_CREATE_DATE"/>
		<result property="resUpdateDate" column="RES_UPDATE_DATE"/>
		<result property="reviewRating" column="REVIEW_RATING"/>
		<result property="resBookmarkCount" column="BOOKMARK_COUNT"/>
		<result property="resReviewCount" column="REVIEW_COUNT"/>
		<result property="resViewCount" column="RES_VIEWCOUNT"/>
	</resultMap>
	
	<resultMap type="Option" id="OptionMap">
		<id property="resId" column="RES_ID"/>
		<id property="optionId" column="FILTER_ID"/>
		<result property="optionName" column="FILTER_NAME"/>
	</resultMap>
	
	<resultMap type="Info" id="InfoMap">
		<id property="resId" column="RES_ID"/>
		<result property="infoCategoryName" column="RES_CATEGORY_NAME"/>
		<result property="infoBestMenu" column="BESTMENU_NAME"/>
		<result property="infoOperatingTime" column="RES_TIME"/>
		<collection property="infoOption" resultMap="OptionMap"></collection>
	</resultMap>
	
	<select id="getListCount" parameterType="hashmap" resultType="_int">
		SELECT COUNT(*)
		  FROM SELECT_RES SR
		  LEFT OUTER JOIN BESTMENU BM ON (SR.RES_ID = BM.RES_ID)
		 WHERE SR.RES_STATUS = 'Y'
		  <if test="location!=0">
		  	AND SR.LOCATION_ID = #{location}
		  </if>
		  <if test="!'all'.equals(keyword)">
		  	AND SR.RES_NAME LIKE '%'||#{keyword}||'%' OR BM.BESTMENU_NAME LIKE '%'||#{keyword}||'%'    
		  </if>  
	</select>
</mapper>