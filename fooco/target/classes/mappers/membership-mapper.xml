<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="membershipMapper">
<resultMap type="Membership" id="membershipResultSet">
	<id property="membershipId" column="MEMBERSHIP_ID"></id>
	<result property="membershipName" column="MEMBERSHIP_NAME"></result>
	<result property="membershipContent" column="MEMBERSHIP_CONTENT"></result>
	<result property="membershipPrice" column="MEMBERSHIP_PRICE"></result>
	<result property="membershipDuringDate" column="MEMBERSHIP_DURINGDATE"></result>
	<result property="membershipEnrollDate" column="MEMBERSHIP_ENROLLDATE"></result>
	<result property="membershipExpireDate" column="MEMBERSHIP_EXPIREDATE"></result>
	<result property="membershipStatus" column="MS_STATUS"></result>
</resultMap>

<!-- 멤버십 조회 -->
<select id="selectMembership" resultMap="membershipResultSet">
	SELECT *
	FROM MEMBERSHIP
</select>

<!-- 결제 후 Gold멤버십 insert -->
<insert id="insertGoldMembership" parameterType="Membership">
    	INSERT ALL
    	INTO MEMBERSHIP_LIST VALUES(SEQ_MEMBERSHIPLISTID.NEXTVAL,#{buy_memberId},#{membershipId1},SYSDATE,SYSDATE+(INTERVAL '1' YEAR),DEFAULT)
    	INTO PAYMENT_LIST VALUES(SEQ_PAYMENTLISTID.NEXTVAL,#{membershipId1},#{buy_memberId},SYSDATE)
    	SELECT *
    	FROM DUAL 
</insert>

<!-- 결제 후 Silver멤버십 insert -->
<insert id="insertSilverMembership" parameterType="Membership">
    	INSERT ALL
    	INTO MEMBERSHIP_LIST VALUES(SEQ_MEMBERSHIPLISTID.NEXTVAL,#{buy_memberId},#{membershipId2},SYSDATE,SYSDATE+(INTERVAL '6' MONTH),DEFAULT)
    	INTO PAYMENT_LIST VALUES(SEQ_PAYMENTLISTID.NEXTVAL,#{membershipId2},#{buy_memberId},SYSDATE)
    	SELECT *
    	FROM DUAL 
</insert>

<insert id="insertCoupon1" parameterType="Membership">
      INSERT INTO COUPON_LIST VALUES(SEQ_COUPONLISTID.NEXTVAL,#{buy_coupon1},SEQ_MEMBERSHIPLISTID.CURRVAL,SYSDATE,SYSDATE+(INTERVAL '1' MONTH),DEFAULT)   
</insert>
<insert id="insertCoupon2" parameterType="Membership">
      INSERT INTO COUPON_LIST VALUES(SEQ_COUPONLISTID.NEXTVAL,#{buy_coupon3},SEQ_MEMBERSHIPLISTID.CURRVAL,SYSDATE,SYSDATE+(INTERVAL '1' YEAR),DEFAULT)
</insert>
<insert id="insertCoupon3" parameterType="Membership">
      INSERT INTO COUPON_LIST VALUES(SEQ_COUPONLISTID.NEXTVAL,#{buy_coupon2},SEQ_MEMBERSHIPLISTID.CURRVAL,SYSDATE,SYSDATE+(INTERVAL '6' MONTH),DEFAULT)
</insert>

<!-- 해당 회원 멤버십 내역 조회 -->
<select id="selectforMembership" resultMap="membershipResultSet"> 
	SELECT MEMBERSHIP_ENROLLDATE,MEMBERSHIP_EXPIREDATE,MEMBERSHIP_NAME
	FROM MEMBERSHIP_LIST,MEMBERSHIP
	WHERE MEMBERSHIP_LIST.MEMBERSHIP_ID=MEMBERSHIP.MEMBERSHIP_ID
    AND MEMBER_ID=#{memberId}
</select>
  
</mapper>
