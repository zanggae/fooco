<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="themeMapper">



<resultMap type="Theme" id="ThemeResultSet">
	<id property="themeId" column="THEME_ID"/>
   	<result property="themeTitle" column="THEME_TITLE"/>
   	<result property="themeUploadDate" column="THEME_UPLOAD_DATE"/>
   	<result property="themeModifyDate" column="THEME_MODIFY_DATE"/>
   	<result property="memberNo" column="MEMBER_NO"/>
   	<result property="themeCount" column="THEME_COUNT"/>
   	<result property="themeBookmarkId" column="HEME_BOOKMARK_ID"/>
   	<result property="imageId" column="IMAGE_ID"/>
   	<result property="imageOriginName" column="IMAGE_ORIGIN_NAME"/>
   	<result property="imageNewName" column="IMAGE_NEW_NAME"/>
   	<result property="imageFilePath" column="IMAGE_FILEPATH"/>
   	<result property="imageCreateDate" column="IMAGE_CREATE_DATE"/>
   	<result property="imageLevel" column="IMAGE_LEVEL"/>
   	<result property="imageStatus" column="IMAGE_STATUS"/>
   	<result property="imageDownloadCount" column="IMAGE_DOWNLOAD_COUNT"/>
   	<result property="bookmarkLikeCount" column="THEME_BOOKMARK_COUNT"/>
   	<result property="resId" column="RES_ID"/>
 

</resultMap>



<!-- 테마 메인 조회 쿼리-->
<select id="selectListTheme" resultMap="ThemeResultSet" >
	SELECT
	THEME_ID,THEME_TITLE,RES_ID,IMAGE_ID,IMAGE_ORIGIN_NAME,IMAGE_NEW_NAME,IMAGE_FILEPATH,
	RANK() OVER (ORDER BY THEME_COUNT DESC) AS COUNT
	FROM SELECT_THEME
	
</select>

<!-- 검색한 테마 조회 -->
<select id="searchListTheme" parameterType="string" resultMap="ThemeResultSet">
	SELECT
	THEME_ID,THEME_TITLE,RES_ID,IMAGE_ID,IMAGE_ORIGIN_NAME,IMAGE_NEW_NAME,IMAGE_FILEPATH
	FROM SELECT_THEME
	WHERE THEME_TITLE LIKE '%'||#{searchTheme}||'%' ORDER BY THEME_TITLE

</select>



<!-- 테마 즐겨찾기 쿼리-->
<insert id="insertThemeLike">
	INSERT INTO THEME_BOOKMARK (MEMBER_NO, THEME_NO)
	VALUES(#{memberNo}, #{themeNo))
</insert>

<delete id="deleteThemeLike">
	DELETE FROM THEME_BOOKMARK
	WHERE MEMBER_NO = #{themeNo} AND MEMBER_NO = #{memberNo}
</delete>

<select id="updateThemeLike">
	UPDATE THEME
	SET THEME_BOOKMARK_COUNT = (SELECT COUNT(*)
	FROM THEME_BOOKMARK
	WHERE THEME_NO = #{themeNo})
	WHERE THEME_ID = #{themeId}

</select>

<select id="getThemeLike" resultType="int">
	SELECT COUNT(THEME_BOOKMARK_ID) FROM THEME_BOOKMARK
	WHERE THEME_NO = #{themeNo} AND MEMBER_NO = #{memberNo}
</select>






</mapper>
